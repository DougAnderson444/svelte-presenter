<script>
	import { onMount } from 'svelte'
	import Output from './Output.svelte'
	import { TabControl, TabControlItem } from 'renderless-svelte'

	export let components = []

	let compiled
	let worker
	
	$: worker && worker.postMessage(components)

	onMount(() => {
		worker = new Worker('./worker.js')

		worker.addEventListener('message', event => {
			compiled = event.data 
		})
		components = components
	})
</script>

<div class="wrapper">
	<div class="input">
		<TabControl>			
			<div class="tabs" slot="tabs" let:tabs>        
				{#each tabs as { active, payload, select }}
					<button class:active on:click="{select}">{payload}</button>
				{/each}
			</div>
			{#each components as component, id}			
				<TabControlItem {id} payload={`${component.name}.${component.type}`} active={id === 0}>
					<textarea 
						autocomplete="off"
						autocorrect="off"
						autocapitalize="off"
						spellcheck="false"
						bind:value={component.source}
					/>
				</TabControlItem>
			{/each}
		</TabControl>
	</div>
	<div class="output">
		<Output {compiled} />
	</div>
</div>

<style>	
	.wrapper {
		display: flex;
		flex: 1 0;
		flex-direction: row;
		gap: .5rem;
	}
	.input, 
	.output {
		display: flex;
		flex-direction: column;
		flex: 1 0;
	}
	.tabs {
		display: flex;
		flex-direction: row;
	}
	button {
		background-color: white;
		border: 2px solid hsl(var(--hue), 100%, 50%);
		border-bottom: 0;
		border-right-width: 1px;
		cursor: pointer;
		padding: .25rem .5rem;
	}
	button:first-child {
		border-top-left-radius: .25rem;
	}
	button:last-child {
		border-top-right-radius: .25rem;
		border-right-width: 2px;
	}
	button + button {
		border-left: 0;
	}
	button.active,
	button:active,
	button:focus,
	button:hover {
		background-color: hsla(var(--hue), 100%, 50%, 50%);
		outline: none;
	}
    textarea {
        background-color: white;
        border: 2px solid hsl(var(--hue), 100%, 50%);
		border-radius: 0 .25rem .25rem .25rem;;
		flex: 1 0;
		font-family: monospace;
        padding: .5rem;
        resize: none;
        width: 100%;
	}
	textarea:active,
	textarea:focus,
	textarea:hover {
		outline: none;
	}
</style>